â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ä½¿ç”¨å°æ•°æ®é›†è¿›è¡ŒSFTè®­ç»ƒ - å¿«é€Ÿå‚è€ƒ                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ æ•°æ®æ–‡ä»¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  è®­ç»ƒé›†: data/sft_train_small_train.parquet
  éªŒè¯é›†: data/sft_train_small_valid.parquet

ğŸš€ æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ï¼ˆæ¨èï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  accelerate launch --multi_gpu --num_processes 2 \
      ./train_low_mem.py train \
      --is_finetune=True \
      --use_small_config=True

  è¯´æ˜ï¼š
  âœ… è‡ªåŠ¨ä½¿ç”¨ TrainConfigSFTSmall é…ç½®
  âœ… è‡ªåŠ¨åŠ è½½å°æ•°æ®é›†æ–‡ä»¶
  âœ… è‡ªåŠ¨ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼ˆbatch_size=1, æ¢¯åº¦ç´¯ç§¯=8ï¼‰
  âœ… è®­ç»ƒ3ä¸ªepoch

ğŸ“ å…¶ä»–å¸¸ç”¨å‘½ä»¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # è‡ªå®šä¹‰è®­ç»ƒè½®æ•°å’Œå­¦ä¹ ç‡
  accelerate launch --multi_gpu --num_processes 2 \
      ./train_low_mem.py train \
      --is_finetune=True \
      --use_small_config=True \
      --epochs=5 \
      --learn_rate=3e-5

  # ä»æ–­ç‚¹ç»§ç»­è®­ç»ƒ
  accelerate launch --multi_gpu --num_processes 2 \
      ./train_low_mem.py train \
      --is_finetune=True \
      --use_small_config=True \
      --is_keep_training=True

  # ä½¿ç”¨å•GPUè®­ç»ƒï¼ˆæ›´çœå†…å­˜ï¼‰
  python train_low_mem.py train \
      --is_finetune=True \
      --use_small_config=True

ğŸ” ç›‘æ§è®­ç»ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  # ç›‘æ§å†…å­˜å’ŒGPUï¼ˆå¦ä¸€ä¸ªç»ˆç«¯ï¼‰
  watch -n 2 'free -h && echo "---GPU---" && nvidia-smi'

  # æŸ¥çœ‹è®­ç»ƒæ—¥å¿—
  tail -f logs/*.log

  # æŸ¥çœ‹ä¿å­˜çš„æ¨¡å‹
  ls -lh model_save/sft_small/

ğŸ“Š é…ç½®ä¿¡æ¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  é…ç½®ç±»: TrainConfigSFTSmall
  Batch size: 1 per GPU
  æ¢¯åº¦ç´¯ç§¯: 8 steps
  æœ‰æ•ˆbatch size: 1 Ã— 2(GPU) Ã— 8 = 16
  Epochs: 3
  å­¦ä¹ ç‡: 5e-5
  é¢„æœŸå†…å­˜: 8-10GBï¼ˆåŒGPUï¼‰
  é¢„æœŸæ—¶é•¿: 6-12å°æ—¶ï¼ˆ3ä¸ªepochï¼‰

âœ… è®­ç»ƒå‰æ£€æŸ¥æ¸…å•
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  â–¡ æ•°æ®æ–‡ä»¶å­˜åœ¨
    ls -lh data/sft_train_small_*.parquet

  â–¡ é¢„è®­ç»ƒæ¨¡å‹å­˜åœ¨
    ls -lh model_save/chat_small_t5.best.bin

  â–¡ ç£ç›˜ç©ºé—´å……è¶³ï¼ˆè‡³å°‘5GBï¼‰
    df -h

  â–¡ å†…å­˜å……è¶³ï¼ˆè‡³å°‘13GBå¯ç”¨ï¼‰
    free -h

âš™ï¸ å‚æ•°è¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  å¿…éœ€å‚æ•°:
    train                    æ‰§è¡Œè®­ç»ƒå‡½æ•°
    --is_finetune=True       å¯ç”¨SFTå¾®è°ƒæ¨¡å¼

  æ¨èå‚æ•°:
    --use_small_config=True  ä½¿ç”¨å°æ•°æ®é›†é…ç½®

  å¯é€‰å‚æ•°:
    --is_keep_training=True  ä»æ–­ç‚¹ç»§ç»­è®­ç»ƒ
    --epochs=N               è‡ªå®šä¹‰è®­ç»ƒè½®æ•°
    --learn_rate=X           è‡ªå®šä¹‰å­¦ä¹ ç‡

ğŸ“ˆ é¢„æœŸæ•ˆæœ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  è®­ç»ƒLoss: 0.5-1.0
  éªŒè¯BLEU: 0.3-0.5
  æ¨¡å‹å¤§å°: ~700MB
  ä¿å­˜ä½ç½®: model_save/sft_small/chat_small_t5.best.bin

âš ï¸  å†…å­˜ä¸å¤Ÿï¼Ÿ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  1. ä½¿ç”¨å•GPUè®­ç»ƒ
     python train_low_mem.py train --is_finetune=True --use_small_config=True

  2. å‡å°‘æ•°æ®é‡ï¼ˆå‡†å¤‡æ›´å°çš„æ•°æ®é›†ï¼‰

  3. å‡å°‘åºåˆ—é•¿åº¦ï¼ˆä¿®æ”¹config.pyä¸­çš„max_seq_lenï¼‰

ğŸ“š æ›´å¤šå¸®åŠ©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  è¯¦ç»†æŒ‡å—: cat SMALL_DATASET_TRAINING_GUIDE.md
  é…ç½®æ–‡ä»¶: config.py (TrainConfigSFTSmall)
  è®­ç»ƒè„šæœ¬: train_low_mem.py

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ç°åœ¨å°±å¼€å§‹è®­ç»ƒï¼                                                              â•‘
â•‘  accelerate launch --multi_gpu --num_processes 2 \                           â•‘
â•‘      ./train_low_mem.py train --is_finetune=True --use_small_config=True    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
